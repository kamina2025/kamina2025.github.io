<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Reproductor WebTorrent - Capítulo 1</title>
    <style>
      body { font-family: sans-serif; margin: 20px; text-align: center; background-color: #f0f0f0; }
      #player-container {
        width: 80%;
        max-width: 800px;
        margin: 20px auto;
        border: 1px solid #ccc;
        background-color: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 400px;
        color: white;
        font-size: 1.2em;
      }
      #player-container video {
        max-width: 100%;
        max-height: 100%;
      }
      #status {
        margin-top: 10px;
        font-size: 0.9em;
        color: #555;
      }
      h1 {
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>Vigilante: Boku no Hero Academia ILLEGALS - Capítulo 1</h1>

    <div id="player-container">
      Cargando video...
    </div>
    <div id="status">Iniciando...</div>

    <!-- Carga la librería WebTorrent.js desde su CDN oficial -->
    <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script>

    <!-- Tu script personalizado para usar WebTorrent -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
          const playerContainer = document.getElementById('player-container');
          const statusDiv = document.getElementById('status');

          if (typeof WebTorrent === 'undefined') {
              console.error('WebTorrent no está definido. El script no se cargó correctamente.');
              statusDiv.textContent = 'Error: El reproductor no se pudo cargar. Revisa la consola del navegador.';
              return;
          }

          const client = new WebTorrent({
              tracker: {
                  // Puedes dejar esta propiedad vacía o añadir trackers si los conoces
              },
              iceServers: [
                  { urls: 'stun:stun.l.google.com:19302' },
                  { urls: 'stun:stun1.l.google.com:19302' },
                  { urls: 'stun:stun2.l.google.com:19302' },
                  { urls: 'stun:stun3.l.google.com:19302' },
                  { urls: 'stun:stun4.l.google.com:19302' }
              ]
          });

          client.on('error', (err) => {
              console.error('WebTorrent Error:', err);
              statusDiv.textContent = `Error: ${err.message || err}`;
          });

          // *** ENLACE MAGNET HARDCODEADO ***
          const magnetLink = 'magnet:?xt=urn:btih:5ab5136378ac9f996f4d7ca6855823bef3f49b45&dn=Vigilante+Boku+no+Hero+Academia+ILLEGALS+Cap+1+SUB+ESPANOLHD+Ve.mp4&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337&tr=udp%3A%2F%2Fexplodie.org%3A6969&tr=udp%3A%2F%2Ftracker.empire-js.us%3A1337&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=wss%3A%2F%2Ftracker.openwebtorrent.com';

          playerContainer.innerHTML = 'Cargando metadatos...';
          statusDiv.textContent = 'Iniciando descarga...';

          client.add(magnetLink, (torrent) => {
              console.log('Cliente descargando:', torrent.infoHash);
              statusDiv.textContent = `Descargando: ${torrent.name}`;

              const file = torrent.files.find((f) => {
                  return f.name.endsWith('.mp4') || f.name.endsWith('.webm') || f.name.endsWith('.mkv');
              });

              if (file) {
                  playerContainer.innerHTML = '';
                  file.appendTo(playerContainer, (err, elem) => {
                      if (err) {
                          console.error('Error al añadir archivo al reproductor:', err);
                          statusDiv.textContent = `Error de reproducción: ${err.message}`;
                          return;
                      }
                      console.log('Video listo para reproducir:', file.name);
                      statusDiv.textContent = `Reproduciendo: ${file.name}`;
                      elem.controls = true;
                      elem.autoplay = true; // Reproducir automáticamente
                  });

                  torrent.on('download', () => {
                      const progress = (torrent.progress * 100).toFixed(1);
                      statusDiv.textContent = `Descargando: ${torrent.name} (${progress}%) - Velocidad: ${(client.downloadSpeed / 1024 / 1024).toFixed(2)} MB/s`;
                  });
              } else {
                  playerContainer.innerHTML = 'No se encontró un archivo de video compatible en el torrent.';
                  statusDiv.textContent = 'Error: No se encontró video.';
              }
          });
      });
    </script>
  </body>
</html>